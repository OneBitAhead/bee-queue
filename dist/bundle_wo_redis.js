var c=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var T=c((ui,Ie)=>{"use strict";function $t(r){if(r.length===0||!(r instanceof Array))return null;for(var e={},t=0;t<r.length;t+=2)e[r[t].toString("binary")]=r[t+1];return e}function Oe(r){if(r instanceof Buffer)return r.toString();if(r instanceof Array){for(var e=new Array(r.length),t=0;t<r.length;t++)e[t]=Oe(r[t]);return e}return r}function Vt(r,e){console.log(r?r.toString():"Reply: "+e)}var se;function ae(r){var e;if(Array.isArray(r)){e=new Array(r.length);for(var t=0;t<r.length;t++)e[t]=ae(r[t]);return e}if(Object.prototype.toString.call(r)==="[object Object]"){e={};for(var i=Object.keys(r),s;s=i.pop();){if(s==="tls"){e[s]=r[s];continue}var a=s.replace(/[A-Z][^A-Z]/g,"_$&").toLowerCase();a!==s.toLowerCase()&&(se=!0),e[a]=ae(r[s])}return e}return r}function Ht(r){return se=!1,r=ae(r)||{},se&&(r.camel_case=!0),r}function j(r,e,t,i){e?e(t,i):t&&r.emit("error",t)}function Qt(r,e,t,i,s){var a;if(s?a=s.peekBack():a=r.offline_queue.peekBack()||r.command_queue.peekBack(),!a)process.nextTick(function(){j(r,e,t,i)});else{var n=a.callback;a.callback=n?function(o,l){n(o,l),j(r,e,t,i)}:function(o,l){o&&r.emit("error",o),j(r,e,t,i)}}}Ie.exports={reply_to_strings:Oe,reply_to_object:$t,print:Vt,err_code:/^([A-Z]+)\s+(.+)$/,monitor_regex:/^[0-9]{10,11}\.[0-9]+ \[[0-9]+ .+\].*"$/,clone:Ht,callback_or_emit:j,reply_in_order:Qt}});var x=c((fi,Ke)=>{"use strict";var Xt=/development/i.test(process.env.NODE_ENV)||/\bredis\b/i.test(process.env.NODE_DEBUG);function Zt(r,e,t,i){this.command=r,this.args=e,this.buffer_args=!1,this.callback=t,this.call_on_write=i,Xt&&(this.error=new Error)}Ke.exports=Zt});var ne=c((ci,Pe)=>{"use strict";function m(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}m.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var i=this.size();if(!(t>=i||t<-i))return t<0&&(t+=i),t=this._head+t&this._capacityMask,this._list[t]}};m.prototype.get=function(e){return this.peekAt(e)};m.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};m.prototype.peekFront=function(){return this.peek()};m.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(m.prototype,"length",{get:function(){return this.size()}});m.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};m.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};m.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};m.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};m.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var i=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),i}};m.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var i=this.size(),s=this._list.length;if(!(t>=i||t<-i)){t<0&&(t+=i),t=this._head+t&this._capacityMask;var a=this._list[t],n;if(e<i/2){for(n=e;n>0;n--)this._list[t]=this._list[t=t-1+s&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(n=i-1-e;n>0;n--)this._list[t]=this._list[t=t+1+s&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+s&this._capacityMask}return a}}};m.prototype.remove=function(e,t){var i=e,s,a=t;if(i===(i|0)&&this._head!==this._tail){var n=this.size(),o=this._list.length;if(!(i>=n||i<-n||t<1)){if(i<0&&(i+=n),t===1||!t)return s=new Array(1),s[0]=this.removeOne(i),s;if(i===0&&i+t>=n)return s=this.toArray(),this.clear(),s;i+t>n&&(t=n-i);var l;for(s=new Array(t),l=0;l<t;l++)s[l]=this._list[this._head+i+l&this._capacityMask];if(i=this._head+i&this._capacityMask,e+t===n){for(this._tail=this._tail-t+o&this._capacityMask,l=t;l>0;l--)this._list[i=i+1+o&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+t+o&this._capacityMask,l=t-1;l>0;l--)this._list[i=i+1+o&this._capacityMask]=void 0;return s}if(i<n/2){for(this._head=this._head+e+t+o&this._capacityMask,l=e;l>0;l--)this.unshift(this._list[i=i-1+o&this._capacityMask]);for(i=this._head-1+o&this._capacityMask;a>0;)this._list[i=i-1+o&this._capacityMask]=void 0,a--;e<0&&(this._tail=i)}else{for(this._tail=i,i=i+t+o&this._capacityMask,l=n-(t+e);l>0;l--)this.push(this._list[i++]);for(i=this._tail;a>0;)this._list[i=i+1+o&this._capacityMask]=void 0,a--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),s}}};m.prototype.splice=function(e,t){var i=e;if(i===(i|0)){var s=this.size();if(i<0&&(i+=s),!(i>s))if(arguments.length>2){var a,n,o,l=arguments.length,u=this._list.length,d=2;if(!s||i<s/2){for(n=new Array(i),a=0;a<i;a++)n[a]=this._list[this._head+a&this._capacityMask];for(t===0?(o=[],i>0&&(this._head=this._head+i+u&this._capacityMask)):(o=this.remove(i,t),this._head=this._head+i+u&this._capacityMask);l>d;)this.unshift(arguments[--l]);for(a=i;a>0;a--)this.unshift(n[a-1])}else{n=new Array(s-(i+t));var E=n.length;for(a=0;a<E;a++)n[a]=this._list[this._head+i+t+a&this._capacityMask];for(t===0?(o=[],i!=s&&(this._tail=this._head+i+u&this._capacityMask)):(o=this.remove(i,t),this._tail=this._tail-E+u&this._capacityMask);d<l;)this.push(arguments[d++]);for(a=0;a<E;a++)this.push(n[a])}return o}else return this.remove(i,t)}};m.prototype.clear=function(){this._head=0,this._tail=0};m.prototype.isEmpty=function(){return this._head===this._tail};m.prototype.toArray=function(){return this._copyArray(!1)};m.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};m.prototype._copyArray=function(e){var t=[],i=this._list,s=i.length,a;if(e||this._head>this._tail){for(a=this._head;a<s;a++)t.push(i[a]);for(a=0;a<this._tail;a++)t.push(i[a])}else for(a=this._head;a<this._tail;a++)t.push(i[a]);return t};m.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};m.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};Pe.exports=m});var De=c((hi,ze)=>{"use strict";var Ne=require("assert"),M=require("util");function R(r){Object.defineProperty(this,"message",{value:r||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}M.inherits(R,Error);Object.defineProperty(R.prototype,"name",{value:"RedisError",configurable:!0,writable:!0});function oe(r,e,t){Ne(e),Ne.strictEqual(typeof t,"number"),Object.defineProperty(this,"message",{value:r||"",configurable:!0,writable:!0});let i=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=i,this.offset=t,this.buffer=e}M.inherits(oe,R);Object.defineProperty(oe.prototype,"name",{value:"ParserError",configurable:!0,writable:!0});function le(r){Object.defineProperty(this,"message",{value:r||"",configurable:!0,writable:!0});let e=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=e}M.inherits(le,R);Object.defineProperty(le.prototype,"name",{value:"ReplyError",configurable:!0,writable:!0});function Y(r){Object.defineProperty(this,"message",{value:r||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}M.inherits(Y,R);Object.defineProperty(Y.prototype,"name",{value:"AbortError",configurable:!0,writable:!0});function ue(r){Object.defineProperty(this,"message",{value:r||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}M.inherits(ue,Y);Object.defineProperty(ue.prototype,"name",{value:"InterruptError",configurable:!0,writable:!0});ze.exports={RedisError:R,ParserError:oe,ReplyError:le,AbortError:Y,InterruptError:ue}});var Je=c((yi,Me)=>{"use strict";var Be=require("assert"),O=class extends Error{get name(){return this.constructor.name}},fe=class extends O{constructor(e,t,i){Be(t),Be.strictEqual(typeof i,"number");let s=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=s,this.offset=i,this.buffer=t}get name(){return this.constructor.name}},ce=class extends O{constructor(e){let t=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=t}get name(){return this.constructor.name}},F=class extends O{get name(){return this.constructor.name}},he=class extends F{get name(){return this.constructor.name}};Me.exports={RedisError:O,ParserError:fe,ReplyError:ce,AbortError:F,InterruptError:he}});var G=c((di,Ue)=>{"use strict";var er=process.version.charCodeAt(1)<55&&process.version.charCodeAt(2)===46?De():Je();Ue.exports=er});var Ye=c((pi,je)=>{"use strict";var Le=require("util"),W=require("assert"),tr=G().RedisError,rr=!1;function I(r,e){W(r,"The options argument is required"),W.strictEqual(typeof r,"object","The options argument has to be of type object"),Object.defineProperty(this,"message",{value:r.message||"",configurable:!0,writable:!0}),(e||e===void 0)&&Error.captureStackTrace(this,I);for(var t=Object.keys(r),i=t.pop();i;i=t.pop())this[i]=r[i]}function $(r){W(r,"The options argument is required"),W.strictEqual(typeof r,"object","The options argument has to be of type object"),I.call(this,r,rr),Object.defineProperty(this,"message",{value:r.message||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,$);for(var e=Object.keys(r),t=e.pop();t;t=e.pop())this[t]=r[t]}Le.inherits(I,tr);Le.inherits($,I);Object.defineProperty(I.prototype,"name",{value:"AbortError",configurable:!0,writable:!0});Object.defineProperty($.prototype,"name",{value:"AggregateError",configurable:!0,writable:!0});je.exports={AbortError:I,AggregateError:$}});var Qe=c((mi,He)=>{"use strict";var _e=require("buffer").Buffer,ir=require("string_decoder").StringDecoder,ye=new ir,Fe=G(),sr=Fe.ReplyError,ar=Fe.ParserError,S=_e.allocUnsafe(32*1024),k=0,V=null,J=0,de=0;function nr(r){let e=r.buffer.length-1;var t=r.offset,i=0,s=1;for(r.buffer[t]===45&&(s=-1,t++);t<e;){let a=r.buffer[t++];if(a===13)return r.offset=t+1,s*i;i=i*10+(a-48)}}function or(r){let e=r.buffer.length-1;var t=r.offset,i=0,s="";for(r.buffer[t]===45&&(s+="-",t++);t<e;){var a=r.buffer[t++];if(a===13)return r.offset=t+1,i!==0&&(s+=i),s;i>429496728?(s+=i*10+(a-48),i=0):a===48&&i===0?s+=0:i=i*10+(a-48)}}function Ge(r){let e=r.offset,t=r.buffer,i=t.length-1;for(var s=e;s<i;)if(t[s++]===13)return r.offset=s+1,r.optionReturnBuffers===!0?r.buffer.slice(e,s-1):r.buffer.toString("utf8",e,s-1)}function We(r){let e=r.buffer.length-1;for(var t=r.offset,i=0;t<e;){let s=r.buffer[t++];if(s===13)return r.offset=t+1,i;i=i*10+(s-48)}}function lr(r){return r.optionStringNumbers===!0?or(r):nr(r)}function ur(r){let e=We(r);if(e===void 0)return;if(e<0)return null;let t=r.offset+e;if(t+2>r.buffer.length){r.bigStrSize=t+2,r.totalChunkSize=r.buffer.length,r.bufferCache.push(r.buffer);return}let i=r.offset;return r.offset=t+2,r.optionReturnBuffers===!0?r.buffer.slice(i,t):r.buffer.toString("utf8",i,t)}function fr(r){var e=Ge(r);if(e!==void 0)return r.optionReturnBuffers===!0&&(e=e.toString()),new sr(e)}function cr(r,e){let t=new ar("Protocol error, got "+JSON.stringify(String.fromCharCode(e))+" as reply type byte",JSON.stringify(r.buffer),r.offset);r.buffer=null,r.returnFatalError(t)}function hr(r){let e=We(r);if(e===void 0)return;if(e<0)return null;let t=new Array(e);return $e(r,t,0)}function pe(r,e,t){r.arrayCache.push(e),r.arrayPos.push(t)}function me(r){let e=r.arrayCache.pop();var t=r.arrayPos.pop();if(r.arrayCache.length){let i=me(r);if(i===void 0){pe(r,e,t);return}e[t++]=i}return $e(r,e,t)}function $e(r,e,t){let i=r.buffer.length;for(;t<e.length;){let s=r.offset;if(r.offset>=i){pe(r,e,t);return}let a=Ve(r,r.buffer[r.offset++]);if(a===void 0){r.arrayCache.length||r.bufferCache.length||(r.offset=s),pe(r,e,t);return}e[t]=a,t++}return e}function Ve(r,e){switch(e){case 36:return ur(r);case 43:return Ge(r);case 42:return hr(r);case 58:return lr(r);case 45:return fr(r);default:return cr(r,e)}}function yr(){if(S.length>50*1024)if(J===1||de>J*2){let r=Math.floor(S.length/10),e=r<k?k:r;k=0,S=S.slice(e,S.length)}else de++,J--;else clearInterval(V),J=0,de=0,V=null}function dr(r){if(S.length<r+k){let e=r>78643200?2:3;k>1024*1024*111&&(k=1024*1024*50),S=_e.allocUnsafe(r*e+k),k=0,J++,V===null&&(V=setInterval(yr,50))}}function pr(r){let e=r.bufferCache,t=r.offset;var i=e.length,s=r.bigStrSize-r.totalChunkSize;if(r.offset=s,s<=2){if(i===2)return e[0].toString("utf8",t,e[0].length+s-2);i--,s=e[e.length-2].length+s}for(var a=ye.write(e[0].slice(t)),n=1;n<i-1;n++)a+=ye.write(e[n]);return a+=ye.end(e[n].slice(0,s-2)),a}function mr(r){let e=r.bufferCache,t=r.offset,i=r.bigStrSize-t-2;var s=e.length,a=r.bigStrSize-r.totalChunkSize;if(r.offset=a,a<=2){if(s===2)return e[0].slice(t,e[0].length+a-2);s--,a=e[e.length-2].length+a}dr(i);let n=k;e[0].copy(S,n,t,e[0].length),k+=e[0].length-t;for(var o=1;o<s-1;o++)e[o].copy(S,k),k+=e[o].length;return e[o].copy(S,k,0,a-2),k+=a-2,S.slice(n,k)}var ge=class{constructor(e){if(!e)throw new TypeError("Options are mandatory.");if(typeof e.returnError!="function"||typeof e.returnReply!="function")throw new TypeError("The returnReply and returnError options have to be functions.");this.setReturnBuffers(!!e.returnBuffers),this.setStringNumbers(!!e.stringNumbers),this.returnError=e.returnError,this.returnFatalError=e.returnFatalError||e.returnError,this.returnReply=e.returnReply,this.reset()}reset(){this.offset=0,this.buffer=null,this.bigStrSize=0,this.totalChunkSize=0,this.bufferCache=[],this.arrayCache=[],this.arrayPos=[]}setReturnBuffers(e){if(typeof e!="boolean")throw new TypeError("The returnBuffers argument has to be a boolean");this.optionReturnBuffers=e}setStringNumbers(e){if(typeof e!="boolean")throw new TypeError("The stringNumbers argument has to be a boolean");this.optionStringNumbers=e}execute(e){if(this.buffer===null)this.buffer=e,this.offset=0;else if(this.bigStrSize===0){let i=this.buffer.length,s=i-this.offset,a=_e.allocUnsafe(s+e.length);if(this.buffer.copy(a,0,this.offset,i),e.copy(a,s,0,e.length),this.buffer=a,this.offset=0,this.arrayCache.length){let n=me(this);if(n===void 0)return;this.returnReply(n)}}else if(this.totalChunkSize+e.length>=this.bigStrSize){this.bufferCache.push(e);var t=this.optionReturnBuffers?mr(this):pr(this);if(this.bigStrSize=0,this.bufferCache=[],this.buffer=e,this.arrayCache.length&&(this.arrayCache[0][this.arrayPos[0]++]=t,t=me(this),t===void 0))return;this.returnReply(t)}else{this.bufferCache.push(e),this.totalChunkSize+=e.length;return}for(;this.offset<this.buffer.length;){let i=this.offset,s=this.buffer[this.offset++],a=Ve(this,s);if(a===void 0){this.arrayCache.length||this.bufferCache.length||(this.offset=i);return}s===45?this.returnError(a):this.returnReply(a)}this.buffer=null}};He.exports=ge});var Ze=c((gi,Xe)=>{"use strict";Xe.exports=Qe()});var et=c((_i,gr)=>{gr.exports={acl:{arity:-2,flags:["admin","noscript","loading","stale","skip_slowlog"],keyStart:0,keyStop:0,step:0},append:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},asking:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},auth:{arity:-2,flags:["noscript","loading","stale","skip_monitor","skip_slowlog","fast","no_auth"],keyStart:0,keyStop:0,step:0},bgrewriteaof:{arity:1,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},bgsave:{arity:-1,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},bitcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},bitfield:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},bitfield_ro:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},bitop:{arity:-4,flags:["write","denyoom"],keyStart:2,keyStop:-1,step:1},bitpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},blmove:{arity:6,flags:["write","denyoom","noscript"],keyStart:1,keyStop:2,step:1},blpop:{arity:-3,flags:["write","noscript"],keyStart:1,keyStop:-2,step:1},brpop:{arity:-3,flags:["write","noscript"],keyStart:1,keyStop:-2,step:1},brpoplpush:{arity:4,flags:["write","denyoom","noscript"],keyStart:1,keyStop:2,step:1},bzpopmax:{arity:-3,flags:["write","noscript","fast"],keyStart:1,keyStop:-2,step:1},bzpopmin:{arity:-3,flags:["write","noscript","fast"],keyStart:1,keyStop:-2,step:1},client:{arity:-2,flags:["admin","noscript","random","loading","stale"],keyStart:0,keyStop:0,step:0},cluster:{arity:-2,flags:["admin","random","stale"],keyStart:0,keyStop:0,step:0},command:{arity:-1,flags:["random","loading","stale"],keyStart:0,keyStop:0,step:0},config:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},copy:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},dbsize:{arity:1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},debug:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},decr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},decrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},del:{arity:-2,flags:["write"],keyStart:1,keyStop:-1,step:1},discard:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},dump:{arity:2,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},echo:{arity:2,flags:["fast"],keyStart:0,keyStop:0,step:0},eval:{arity:-3,flags:["noscript","may_replicate","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha:{arity:-3,flags:["noscript","may_replicate","movablekeys"],keyStart:0,keyStop:0,step:0},exec:{arity:1,flags:["noscript","loading","stale","skip_monitor","skip_slowlog"],keyStart:0,keyStop:0,step:0},exists:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},expire:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expireat:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},failover:{arity:-1,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},flushall:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},flushdb:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},geoadd:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},geodist:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},geohash:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},geopos:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadius:{arity:-6,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadius_ro:{arity:-6,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadiusbymember:{arity:-5,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadiusbymember_ro:{arity:-5,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearch:{arity:-7,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearchstore:{arity:-8,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},get:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getbit:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getdel:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getex:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},getset:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},hello:{arity:-1,flags:["noscript","loading","stale","skip_monitor","skip_slowlog","fast","no_auth"],keyStart:0,keyStop:0,step:0},hexists:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hget:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hgetall:{arity:2,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},hincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hincrbyfloat:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hkeys:{arity:2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:1,step:1},hlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmget:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},"host:":{arity:-1,flags:["readonly","loading","stale"],keyStart:0,keyStop:0,step:0},hrandfield:{arity:-2,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},hscan:{arity:-3,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},hset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hsetnx:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hstrlen:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hvals:{arity:2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:1,step:1},incr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrbyfloat:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},info:{arity:-1,flags:["random","loading","stale"],keyStart:0,keyStop:0,step:0},keys:{arity:2,flags:["readonly","sort_for_script"],keyStart:0,keyStop:0,step:0},lastsave:{arity:1,flags:["random","loading","stale","fast"],keyStart:0,keyStop:0,step:0},latency:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},lindex:{arity:3,flags:["readonly"],keyStart:1,keyStop:1,step:1},linsert:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},llen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},lmove:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},lolwut:{arity:-1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},lpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},lpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},lpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},lrem:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},lset:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},ltrim:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},memory:{arity:-2,flags:["readonly","random","movablekeys"],keyStart:0,keyStop:0,step:0},mget:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},migrate:{arity:-6,flags:["write","random","movablekeys"],keyStart:0,keyStop:0,step:0},module:{arity:-2,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},monitor:{arity:1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},move:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},mset:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},msetnx:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},multi:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},object:{arity:-2,flags:["readonly","random"],keyStart:2,keyStop:2,step:1},persist:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpire:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpireat:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pfadd:{arity:-2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},pfcount:{arity:-2,flags:["readonly","may_replicate"],keyStart:1,keyStop:-1,step:1},pfdebug:{arity:-3,flags:["write","denyoom","admin"],keyStart:2,keyStop:2,step:1},pfmerge:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},pfselftest:{arity:1,flags:["admin"],keyStart:0,keyStop:0,step:0},ping:{arity:-1,flags:["stale","fast"],keyStart:0,keyStop:0,step:0},post:{arity:-1,flags:["readonly","loading","stale"],keyStart:0,keyStop:0,step:0},psetex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},psubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},psync:{arity:-3,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},pttl:{arity:2,flags:["readonly","random","fast"],keyStart:1,keyStop:1,step:1},publish:{arity:3,flags:["pubsub","loading","stale","fast","may_replicate"],keyStart:0,keyStop:0,step:0},pubsub:{arity:-2,flags:["pubsub","random","loading","stale"],keyStart:0,keyStop:0,step:0},punsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},quit:{arity:1,flags:["loading","stale","readonly"],keyStart:0,keyStop:0,step:0},randomkey:{arity:1,flags:["readonly","random"],keyStart:0,keyStop:0,step:0},readonly:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},readwrite:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},rename:{arity:3,flags:["write"],keyStart:1,keyStop:2,step:1},renamenx:{arity:3,flags:["write","fast"],keyStart:1,keyStop:2,step:1},replconf:{arity:-1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},replicaof:{arity:3,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},reset:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},restore:{arity:-4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},"restore-asking":{arity:-4,flags:["write","denyoom","asking"],keyStart:1,keyStop:1,step:1},role:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},rpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},rpoplpush:{arity:3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},rpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},rpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},sadd:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},save:{arity:1,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},scan:{arity:-2,flags:["readonly","random"],keyStart:0,keyStop:0,step:0},scard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},script:{arity:-2,flags:["noscript","may_replicate"],keyStart:0,keyStop:0,step:0},sdiff:{arity:-2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:-1,step:1},sdiffstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},select:{arity:2,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},set:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setbit:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setnx:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},setrange:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},shutdown:{arity:-1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},sinter:{arity:-2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:-1,step:1},sinterstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sismember:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},slaveof:{arity:3,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},slowlog:{arity:-2,flags:["admin","random","loading","stale"],keyStart:0,keyStop:0,step:0},smembers:{arity:2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:1,step:1},smismember:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},smove:{arity:4,flags:["write","fast"],keyStart:1,keyStop:2,step:1},sort:{arity:-2,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},spop:{arity:-2,flags:["write","random","fast"],keyStart:1,keyStop:1,step:1},srandmember:{arity:-2,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},srem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},sscan:{arity:-3,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},stralgo:{arity:-2,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},strlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},subscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},substr:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},sunion:{arity:-2,flags:["readonly","sort_for_script"],keyStart:1,keyStop:-1,step:1},sunionstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},swapdb:{arity:3,flags:["write","fast"],keyStart:0,keyStop:0,step:0},sync:{arity:1,flags:["admin","noscript"],keyStart:0,keyStop:0,step:0},time:{arity:1,flags:["random","loading","stale","fast"],keyStart:0,keyStop:0,step:0},touch:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},ttl:{arity:2,flags:["readonly","random","fast"],keyStart:1,keyStop:1,step:1},type:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},unlink:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:-1,step:1},unsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},unwatch:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},wait:{arity:3,flags:["noscript"],keyStart:0,keyStop:0,step:0},watch:{arity:-2,flags:["noscript","loading","stale","fast"],keyStart:1,keyStop:-1,step:1},xack:{arity:-4,flags:["write","random","fast"],keyStart:1,keyStop:1,step:1},xadd:{arity:-5,flags:["write","denyoom","random","fast"],keyStart:1,keyStop:1,step:1},xautoclaim:{arity:-6,flags:["write","random","fast"],keyStart:1,keyStop:1,step:1},xclaim:{arity:-6,flags:["write","random","fast"],keyStart:1,keyStop:1,step:1},xdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xgroup:{arity:-2,flags:["write","denyoom"],keyStart:2,keyStop:2,step:1},xinfo:{arity:-2,flags:["readonly","random"],keyStart:2,keyStop:2,step:1},xlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},xpending:{arity:-3,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},xrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xread:{arity:-4,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},xreadgroup:{arity:-7,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},xrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xsetid:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xtrim:{arity:-2,flags:["write","random"],keyStart:1,keyStop:1,step:1},zadd:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zcard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zdiff:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zdiffstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zinter:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zinterstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zlexcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zmscore:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zpopmax:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zpopmin:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zrandmember:{arity:-2,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},zrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangestore:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},zrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zrem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zremrangebylex:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyrank:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyscore:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zscan:{arity:-3,flags:["readonly","random"],keyStart:1,keyStop:1,step:1},zscore:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zunion:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zunionstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1}}});var be=c(K=>{"use strict";var H=et();K.list=Object.keys(H);var ke={};K.list.forEach(function(r){ke[r]=H[r].flags.reduce(function(e,t){return e[t]=!0,e},{})});K.exists=function(r){return Boolean(H[r])};K.hasFlag=function(r,e){if(!ke[r])throw new Error("Unknown command "+r);return Boolean(ke[r][e])};K.getKeyIndexes=function(r,e,t){var i=H[r];if(!i)throw new Error("Unknown command "+r);if(!Array.isArray(e))throw new Error("Expect args to be an array");var s=[],a,n,o,l;switch(r){case"zunionstore":case"zinterstore":s.push(0);case"eval":case"evalsha":for(o=Number(e[1])+2,a=2;a<o;a++)s.push(a);break;case"sort":for(l=t&&t.parseExternalKey,s.push(0),a=1;a<e.length-1;a++)if(typeof e[a]=="string"){var u=e[a].toUpperCase();u==="GET"?(a+=1,e[a]!=="#"&&(l?s.push([a,tt(e[a])]):s.push(a))):u==="BY"?(a+=1,l?s.push([a,tt(e[a])]):s.push(a)):u==="STORE"&&(a+=1,s.push(a))}break;case"migrate":if(e[2]===""){for(a=5;a<e.length-1;a++)if(e[a].toUpperCase()==="KEYS"){for(var d=a+1;d<e.length;d++)s.push(d);break}}else s.push(2);break;case"xreadgroup":case"xread":for(a=r==="xread"?0:3;a<e.length-1;a++)if(String(e[a]).toUpperCase()==="STREAMS"){for(d=a+1;d<=a+(e.length-1-a)/2;d++)s.push(d);break}break;default:if(i.step>0)for(n=i.keyStart-1,o=i.keyStop>0?i.keyStop:e.length+i.keyStop+1,a=n;a<o;a+=i.step)s.push(a);break}return s};function tt(r){typeof r!="string"&&(r=String(r));var e=r.indexOf("->");return e===-1?r.length:e}});var Q=c((bi,rt)=>{"use strict";var _r=P();function kr(){if(_r.debug_mode){var r=Array.prototype.slice.call(arguments);r.unshift(new Date().toISOString()),console.error.apply(null,r)}}rt.exports=kr});var st=c((Si,it)=>{"use strict";var Se=T(),br=require("url");it.exports=function(e,t,i){if(typeof e=="number"||typeof e=="string"&&/^\d+$/.test(e)){var s;if(typeof t=="string")s=t;else{if(i&&t)throw new TypeError("Unknown type of connection in createClient()");i=i||t}i=Se.clone(i),i.host=s||i.host,i.port=e}else if(typeof e=="string"||e&&e.url){i=Se.clone(e.url?e:t||i);var a=e.url||e,n=br.parse(a,!0,!0);if(n.slashes){if(n.auth){var o=n.auth.indexOf(":");i.password=n.auth.slice(o+1),o>0&&(i.user=n.auth.slice(0,o))}if(n.protocol&&(n.protocol==="rediss:"?i.tls=i.tls||{}:n.protocol!=="redis:"&&console.warn('node_redis: WARNING: You passed "'+n.protocol.substring(0,n.protocol.length-1)+'" as protocol instead of the "redis" protocol!')),n.pathname&&n.pathname!=="/"&&(i.db=n.pathname.substr(1)),n.hostname&&(i.host=n.hostname),n.port&&(i.port=n.port),n.search!==""){var l;for(l in n.query){if(l in i)if(i[l]===n.query[l])console.warn("node_redis: WARNING: You passed the "+l+" option twice!");else throw new RangeError("The "+l+" option is added twice and does not match");i[l]=n.query[l]}}}else{if(n.hostname)throw new RangeError('The redis url must begin with slashes "//" or contain slashes after the redis protocol');i.path=a}}else if((typeof e=="object"||e===void 0)&&(i=Se.clone(e||i),i.host=i.host||t,e&&arguments.length!==1))throw new TypeError("Too many arguments passed to createClient. Please only pass the options object");if(!i)throw new TypeError("Unknown type of connection in createClient()");return i}});var X=c((vi,ot)=>{"use strict";var Sr=ne(),ve=T(),at=x();function q(r,e){this._client=r,this.queue=new Sr;var t,i;if(e)for(var s=0;s<e.length;s++)t=e[s][0],i=e[s].slice(1),Array.isArray(t)?this[t[0]].apply(this,t.slice(1).concat(i)):this[t].apply(this,i)}function nt(r,e,t){var i=e.callback;e.callback=function(s,a){s&&t!==-1&&(i&&i(s),s.position=t,r.errors.push(s)),r.wants_buffers[t]=e.buffer_args,e.callback=i},r._client.internal_send_command(e)}q.prototype.exec_atomic=q.prototype.EXEC_ATOMIC=q.prototype.execAtomic=function(e){return this.queue.length<2?this.exec_batch(e):this.exec(e)};function vr(r,e,t){var i=0,s;if(e){e.errors=r.errors,r.callback?r.callback(e):e.code!=="CONNECTION_BROKEN"&&r._client.emit("error",e);return}if(t)for(;s=r.queue.shift();){if(t[i]instanceof Error){var a=t[i].message.match(ve.err_code);a&&(t[i].code=a[1]),t[i].command=s.command.toUpperCase(),typeof s.callback=="function"&&s.callback(t[i])}else t[i]=r._client.handle_reply(t[i],s.command,r.wants_buffers[i]),typeof s.callback=="function"&&s.callback(null,t[i]);i++}r.callback&&r.callback(null,t)}q.prototype.exec_transaction=function(e){if(this.monitoring||this._client.monitoring){var t=new RangeError("Using transaction with a client that is in monitor mode does not work due to faulty return values of Redis.");return t.command="EXEC",t.code="EXECABORT",ve.reply_in_order(this._client,e,t)}var i=this,s=i.queue.length;i.errors=[],i.callback=e,i._client.cork(),i.wants_buffers=new Array(s),nt(i,new at("multi",[]),-1);for(var a=0;a<s;a++)nt(i,i.queue.get(a),a);return i._client.internal_send_command(new at("exec",[],function(n,o){vr(i,n,o)})),i._client.uncork(),!i._client.should_buffer};function wr(r,e,t){return function(s,a){s?(r.results[t]=s,r.results[t].position=t):r.results[t]=a,e(s,a)}}q.prototype.exec=q.prototype.EXEC=q.prototype.exec_batch=function(e){var t=this,i=t.queue.length,s=0,a;if(i===0)return ve.reply_in_order(t._client,e,null,[]),!t._client.should_buffer;if(t._client.cork(),!e){for(;a=t.queue.shift();)t._client.internal_send_command(a);return t._client.uncork(),!t._client.should_buffer}var n=function(l,u){if(l){t.results.push(l);var d=t.results.length-1;t.results[d].position=d}else t.results.push(u)},o=function(l){return function(u,d){l(u,d),e(null,t.results)}};for(t.results=[];a=t.queue.shift();)typeof a.callback=="function"?a.callback=wr(t,a.callback,s):a.callback=n,typeof e=="function"&&s===i-1&&(a.callback=o(a.callback)),this._client.internal_send_command(a),s++;return t._client.uncork(),!t._client.should_buffer};ot.exports=q});var ht=c(()=>{"use strict";var Z=T(),we=Q(),p=X(),g=x(),Er=/no password is set|called without any password configured/,qr=/LOADING/,y=P().RedisClient;y.prototype.multi=y.prototype.MULTI=function(e){var t=new p(this,e);return t.exec=t.EXEC=t.exec_transaction,t};y.prototype.batch=y.prototype.BATCH=function(e){return new p(this,e)};function lt(r,e,t){return function(i,s){i===null&&(r.selected_db=e),Z.callback_or_emit(r,t,i,s)}}y.prototype.select=y.prototype.SELECT=function(e,t){return this.internal_send_command(new g("select",[e],lt(this,e,t)))};p.prototype.select=p.prototype.SELECT=function(e,t){return this.queue.push(new g("select",[e],lt(this._client,e,t))),this};y.prototype.monitor=y.prototype.MONITOR=function(e){var t=this,i=function(){t.monitoring=!0};return this.internal_send_command(new g("monitor",[],e,i))};p.prototype.monitor=p.prototype.MONITOR=function(e){if(this.exec!==this.exec_transaction){var t=this,i=function(){t._client.monitoring=!0};return this.queue.push(new g("monitor",[],e,i)),this}return this.monitoring=!0,this};function ut(r,e){return function(t,i){t&&t.code==="NR_CLOSED"&&(t=null,i="OK"),Z.callback_or_emit(r,e,t,i),r.stream.writable&&r.stream.destroy()}}y.prototype.QUIT=y.prototype.quit=function(e){var t=this.internal_send_command(new g("quit",[],ut(this,e)));return this.closing=!0,this.ready=!1,t};p.prototype.QUIT=p.prototype.quit=function(e){var t=this._client,i=function(){t.closing=!0,t.ready=!1};return this.queue.push(new g("quit",[],ut(t,e),i)),this};function ft(r,e){return function(t,i){if(i){for(var s={},a=i.toString().split(`\r
`),n,o,l,u=0;u<a.length;u++)if(o=a[u].split(":"),o[1])if(o[0].indexOf("db")===0)for(l=o[1].split(","),s[o[0]]={};n=l.pop();)n=n.split("="),s[o[0]][n[0]]=+n[1];else s[o[0]]=o[1];s.versions=[],s.redis_version&&s.redis_version.split(".").forEach(function(d){s.versions.push(+d)}),r.server_info=s}else r.server_info={};Z.callback_or_emit(r,e,t,i)}}y.prototype.info=y.prototype.INFO=function(e,t){var i=[];return typeof e=="function"?t=e:e!==void 0&&(i=Array.isArray(e)?e:[e]),this.internal_send_command(new g("info",i,ft(this,t)))};p.prototype.info=p.prototype.INFO=function(e,t){var i=[];return typeof e=="function"?t=e:e!==void 0&&(i=Array.isArray(e)?e:[e]),this.queue.push(new g("info",i,ft(this._client,t))),this};function ct(r,e,t,i){return function(s,a){if(s){if(Er.test(s.message))r.warn("Warning: Redis server does not require a password, but a password was supplied."),s=null,a="OK";else if(qr.test(s.message)){we("Redis still loading, trying to authenticate later"),setTimeout(function(){r.auth(e,t,i)},100);return}}Z.callback_or_emit(r,i,s,a)}}y.prototype.auth=y.prototype.AUTH=function(e,t,i){we("Sending auth to "+this.address+" id "+this.connection_id),t instanceof Function&&(i=t,t=null),this.auth_pass=e,this.auth_user=t;var s=this.ready;this.ready=s||this.offline_queue.length===0;var a=this.internal_send_command(new g("auth",t?[t,e]:[e],ct(this,e,t,i)));return this.ready=s,a};p.prototype.auth=p.prototype.AUTH=function(e,t,i){return we("Sending auth to "+this.address+" id "+this.connection_id),t instanceof Function&&(i=t,t=null),this.auth_pass=e,this.auth_user=t,this.queue.push(new g("auth",t?[t,e]:[e],ct(this._client,e,t,i))),this};y.prototype.client=y.prototype.CLIENT=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0],i=arguments[1];else if(Array.isArray(arguments[1]))for(t===3&&(i=arguments[2]),t=arguments[1].length,e=new Array(t+1),e[0]=arguments[0];s<t;s+=1)e[s+1]=arguments[1][s];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this,n=void 0;if(e.length===2&&e[0].toString().toUpperCase()==="REPLY"){var o=e[1].toString().toUpperCase();(o==="ON"||o==="OFF"||o==="SKIP")&&(n=function(){a.reply=o})}return this.internal_send_command(new g("client",e,i,n))};p.prototype.client=p.prototype.CLIENT=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0],i=arguments[1];else if(Array.isArray(arguments[1]))for(t===3&&(i=arguments[2]),t=arguments[1].length,e=new Array(t+1),e[0]=arguments[0];s<t;s+=1)e[s+1]=arguments[1][s];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this._client,n=void 0;if(e.length===2&&e[0].toString().toUpperCase()==="REPLY"){var o=e[1].toString().toUpperCase();(o==="ON"||o==="OFF"||o==="SKIP")&&(n=function(){a.reply=o})}return this.queue.push(new g("client",e,i,n)),this};y.prototype.hmset=y.prototype.HMSET=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0],i=arguments[1];else if(Array.isArray(arguments[1]))for(t===3&&(i=arguments[2]),t=arguments[1].length,e=new Array(t+1),e[0]=arguments[0];s<t;s+=1)e[s+1]=arguments[1][s];else if(typeof arguments[1]=="object"&&(arguments.length===2||arguments.length===3&&(typeof arguments[2]=="function"||typeof arguments[2]>"u"))){e=[arguments[0]];for(var a in arguments[1])e.push(a,arguments[1][a]);i=arguments[2]}else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];return this.internal_send_command(new g("hmset",e,i))};p.prototype.hmset=p.prototype.HMSET=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0],i=arguments[1];else if(Array.isArray(arguments[1]))for(t===3&&(i=arguments[2]),t=arguments[1].length,e=new Array(t+1),e[0]=arguments[0];s<t;s+=1)e[s+1]=arguments[1][s];else if(typeof arguments[1]=="object"&&(arguments.length===2||arguments.length===3&&(typeof arguments[2]=="function"||typeof arguments[2]>"u"))){e=[arguments[0]];for(var a in arguments[1])e.push(a,arguments[1][a]);i=arguments[2]}else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];return this.queue.push(new g("hmset",e,i)),this};y.prototype.subscribe=y.prototype.SUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.internal_send_command(new g("subscribe",e,i,n))};p.prototype.subscribe=p.prototype.SUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this._client,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.queue.push(new g("subscribe",e,i,n)),this};y.prototype.unsubscribe=y.prototype.UNSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.internal_send_command(new g("unsubscribe",e,i,n))};p.prototype.unsubscribe=p.prototype.UNSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this._client,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.queue.push(new g("unsubscribe",e,i,n)),this};y.prototype.psubscribe=y.prototype.PSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.internal_send_command(new g("psubscribe",e,i,n))};p.prototype.psubscribe=p.prototype.PSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this._client,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.queue.push(new g("psubscribe",e,i,n)),this};y.prototype.punsubscribe=y.prototype.PUNSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.internal_send_command(new g("punsubscribe",e,i,n))};p.prototype.punsubscribe=p.prototype.PUNSUBSCRIBE=function(){var e,t=arguments.length,i,s=0;if(Array.isArray(arguments[0]))e=arguments[0].slice(0),i=arguments[1];else for(t=arguments.length,t!==0&&(typeof arguments[t-1]=="function"||typeof arguments[t-1]>"u")&&(t--,i=arguments[t]),e=new Array(t);s<t;s+=1)e[s]=arguments[s];var a=this._client,n=function(){a.pub_sub_mode=a.pub_sub_mode||a.command_queue.length+1};return this.queue.push(new g("punsubscribe",e,i,n)),this}});var pt=c(()=>{"use strict";var yt=T(),dt=Q(),N=P().RedisClient,Ar=x(),Cr=function(){};N.prototype.send_command=N.prototype.sendCommand=function(r,e,t){if(typeof r!="string")throw new TypeError('Wrong input type "'+(r!=null?r.constructor.name:r)+'" for command name');if(r=r.toLowerCase(),!Array.isArray(e))if(e==null)e=[];else if(typeof e=="function"&&t===void 0)t=e,e=[];else throw new TypeError('Wrong input type "'+e.constructor.name+'" for args');if(typeof t!="function"&&t!==void 0)throw new TypeError('Wrong input type "'+(t!==null?t.constructor.name:"null")+'" for callback function');return r==="multi"||typeof this[r]!="function"?this.internal_send_command(new Ar(r,e,t)):(typeof t=="function"&&(e=e.concat([t])),this[r].apply(this,e))};N.prototype.end=function(r){return r?this.flush_and_error({message:"Connection forcefully ended and command aborted.",code:"NR_CLOSED"}):arguments.length===0&&this.warn(`Using .end() without the flush parameter is deprecated and throws from v.3.0.0 on.
Please check the doku (https://github.com/NodeRedis/node_redis) and explictly use flush.`),this.retry_timer&&(clearTimeout(this.retry_timer),this.retry_timer=null),this.stream.removeAllListeners(),this.stream.on("error",Cr),this.connected=!1,this.ready=!1,this.closing=!0,this.stream.destroySoon()};N.prototype.unref=function(){this.connected?(dt("Unref'ing the socket connection"),this.stream.unref()):(dt("Not connected yet, will unref later"),this.once("connect",function(){this.unref()}))};N.prototype.duplicate=function(r,e){typeof r=="function"&&(e=r,r=null);var t=yt.clone(this.options);r=yt.clone(r);for(var i in r)t[i]=r[i];var s=new N(t);if(s.selected_db=r.db||this.selected_db,typeof e=="function"){var a=function(){e(null,s),s.removeAllListeners(n)},n=function(o){e(o),s.end(!0)};s.once("ready",a),s.once("error",n);return}return s}});var kt=c((Ci,_t)=>{"use strict";var Tr=be(),A=X(),C=P().RedisClient,mt=x(),gt=function(r){var e=r.replace(/(?:^([0-9])|[^a-zA-Z0-9_$])/g,"_$1");C.prototype[r]||(C.prototype[r.toUpperCase()]=C.prototype[r]=function(){var t,i=arguments.length,s,a=0;if(Array.isArray(arguments[0]))t=arguments[0],i===2&&(s=arguments[1]);else if(i>1&&Array.isArray(arguments[1]))for(i===3&&(s=arguments[2]),i=arguments[1].length,t=new Array(i+1),t[0]=arguments[0];a<i;a+=1)t[a+1]=arguments[1][a];else for(i!==0&&(typeof arguments[i-1]=="function"||typeof arguments[i-1]>"u")&&(i--,s=arguments[i]),t=new Array(i);a<i;a+=1)t[a]=arguments[a];return this.internal_send_command(new mt(r,t,s))},e!==r&&(C.prototype[e.toUpperCase()]=C.prototype[e]=C.prototype[r]),Object.defineProperty(C.prototype[r],"name",{value:e})),A.prototype[r]||(A.prototype[r.toUpperCase()]=A.prototype[r]=function(){var t,i=arguments.length,s,a=0;if(Array.isArray(arguments[0]))t=arguments[0],i===2&&(s=arguments[1]);else if(i>1&&Array.isArray(arguments[1]))for(i===3&&(s=arguments[2]),i=arguments[1].length,t=new Array(i+1),t[0]=arguments[0];a<i;a+=1)t[a+1]=arguments[1][a];else for(i!==0&&(typeof arguments[i-1]=="function"||typeof arguments[i-1]>"u")&&(i--,s=arguments[i]),t=new Array(i);a<i;a+=1)t[a]=arguments[a];return this.queue.push(new mt(r,t,s)),this},e!==r&&(A.prototype[e.toUpperCase()]=A.prototype[e]=A.prototype[r]),Object.defineProperty(A.prototype[r],"name",{value:e}))};Tr.list.forEach(gt);_t.exports=gt});var P=c(b=>{"use strict";var vt=require("net"),xr=require("tls"),Rr=require("util"),v=T(),bt=x(),Ee=ne(),U=Ye(),wt=require("events"),Or=Ze(),Ae=G(),Ir=be(),_=Q(),Kr=st(),Pr={subscribe:!0,unsubscribe:!0,psubscribe:!0,punsubscribe:!0};function ee(){}function St(r,e,t){return(t===!1||this.message_buffers)&&(r=v.reply_to_strings(r)),e==="hgetall"&&(r=v.reply_to_object(r)),r}b.debug_mode=/\bredis\b/i.test(process.env.NODE_DEBUG);function f(r,e){r=v.clone(r),wt.call(this);var t={},i=this;for(var s in r.tls)t[s]=r.tls[s],(s==="port"||s==="host"||s==="path"||s==="family")&&(r[s]=r.tls[s]);e?(r.stream=e,this.address='"Private stream"'):r.path?(t.path=r.path,this.address=r.path):(t.port=+r.port||6379,t.host=r.host||"127.0.0.1",t.family=!r.family&&vt.isIP(t.host)||(r.family==="IPv6"?6:4),this.address=t.host+":"+t.port),this.connection_options=t,this.connection_id=f.connection_id++,this.connected=!1,this.ready=!1,r.socket_keepalive===void 0&&(r.socket_keepalive=!0),r.socket_initial_delay===void 0&&(r.socket_initial_delay=0);for(var a in r.rename_commands)r.rename_commands[a.toLowerCase()]=r.rename_commands[a];r.return_buffers=!!r.return_buffers,r.detect_buffers=!!r.detect_buffers,r.return_buffers&&r.detect_buffers&&(i.warn("WARNING: You activated return_buffers and detect_buffers at the same time. The return value is always going to be a buffer."),r.detect_buffers=!1),r.detect_buffers&&(this.handle_reply=St),this.should_buffer=!1,this.command_queue=new Ee,this.offline_queue=new Ee,this.pipeline_queue=new Ee,this.connect_timeout=+r.connect_timeout||36e5,this.enable_offline_queue=r.enable_offline_queue!==!1,this.initialize_retry_vars(),this.pub_sub_mode=0,this.subscription_set={},this.monitoring=!1,this.message_buffers=!1,this.closing=!1,this.server_info={},this.auth_pass=r.auth_pass||r.password,this.auth_user=r.auth_user||r.user,this.selected_db=r.db,this.fire_strings=!0,this.pipeline=!1,this.sub_commands_left=0,this.times_connected=0,this.buffers=r.return_buffers||r.detect_buffers,this.options=r,this.reply="ON",this.create_stream(),this.on("newListener",function(n){(n==="message_buffer"||n==="pmessage_buffer"||n==="messageBuffer"||n==="pmessageBuffer")&&!this.buffers&&!this.message_buffers&&(this.reply_parser.optionReturnBuffers=!0,this.message_buffers=!0,this.handle_reply=St)})}Rr.inherits(f,wt);f.connection_id=0;function Nr(r){return new Or({returnReply:function(e){r.return_reply(e)},returnError:function(e){r.return_error(e)},returnFatalError:function(e){e.message+=". Please report this.",r.ready=!1,r.flush_and_error({message:"Fatal error encountered. Command aborted.",code:"NR_FATAL"},{error:e,queues:["command_queue"]}),r.emit("error",e),r.create_stream()},returnBuffers:r.buffers||r.message_buffers,stringNumbers:r.options.string_numbers||!1})}f.prototype.create_stream=function(){var r=this;if(this.reply_parser=Nr(this),this.options.stream){if(this.stream)return;this.stream=this.options.stream}else this.stream&&(this.stream.removeAllListeners(),this.stream.destroy()),this.options.tls?this.stream=xr.connect(this.connection_options):this.stream=vt.createConnection(this.connection_options);this.options.connect_timeout&&this.stream.setTimeout(this.connect_timeout,function(){r.retry_totaltime=r.connect_timeout,r.connection_gone("timeout")});var e=this.options.tls?"secureConnect":"connect";this.stream.once(e,function(){this.removeAllListeners("timeout"),r.times_connected++,r.on_connect()}),this.stream.on("data",function(t){_("Net read "+r.address+" id "+r.connection_id),r.reply_parser.execute(t)}),this.stream.on("error",function(t){r.on_error(t)}),this.stream.once("close",function(t){r.connection_gone("close")}),this.stream.once("end",function(){r.connection_gone("end")}),this.stream.on("drain",function(){r.drain()}),this.stream.setNoDelay(),this.auth_pass!==void 0&&(this.ready=!0,this.auth(this.auth_pass,this.auth_user,function(t){t&&t.code!=="UNCERTAIN_STATE"&&r.emit("error",t)}),this.ready=!1)};f.prototype.handle_reply=function(r,e){return e==="hgetall"&&(r=v.reply_to_object(r)),r};f.prototype.cork=ee;f.prototype.uncork=ee;f.prototype.initialize_retry_vars=function(){this.retry_timer=null,this.retry_totaltime=0,this.retry_delay=200,this.retry_backoff=1.7,this.attempts=1};f.prototype.warn=function(r){var e=this;process.nextTick(function(){e.listeners("warning").length!==0?e.emit("warning",r):console.warn("node_redis:",r)})};f.prototype.flush_and_error=function(r,e){e=e||{};for(var t=[],i=e.queues||["command_queue","offline_queue"],s=0;s<i.length;s++){i[s]==="command_queue"?r.message+=" It might have been processed.":r.message=r.message.replace(" It might have been processed.","");for(var a=this[i[s]].shift();a;a=this[i[s]].shift()){var n=new U.AbortError(r);a.error&&(n.stack=n.stack+a.error.stack.replace(/^Error.*?\n/,`
`)),n.command=a.command.toUpperCase(),a.args&&a.args.length&&(n.args=a.args),e.error&&(n.origin=e.error),typeof a.callback=="function"?a.callback(n):t.push(n)}}if(b.debug_mode&&t.length){var o;t.length===1?o=t[0]:(r.message=r.message.replace("It","They").replace(/command/i,"$&s"),o=new U.AggregateError(r),o.errors=t),this.emit("error",o)}};f.prototype.on_error=function(r){this.closing||(r.message="Redis connection to "+this.address+" failed - "+r.message,_(r.message),this.connected=!1,this.ready=!1,this.options.retry_strategy||this.emit("error",r),this.connection_gone("error",r))};f.prototype.on_connect=function(){_("Stream connected "+this.address+" id "+this.connection_id),this.connected=!0,this.ready=!1,this.emitted_end=!1,this.stream.setKeepAlive(this.options.socket_keepalive,this.options.socket_initial_delay),this.stream.setTimeout(0),this.emit("connect"),this.initialize_retry_vars(),this.options.no_ready_check?this.on_ready():this.ready_check()};f.prototype.on_ready=function(){var r=this;_("on_ready called "+this.address+" id "+this.connection_id),this.ready=!0,this.cork=function(){r.pipeline=!0,r.stream.cork&&r.stream.cork()},this.uncork=function(){r.fire_strings?r.write_strings():r.write_buffers(),r.pipeline=!1,r.fire_strings=!0,r.stream.uncork&&r.stream.uncork()},this.selected_db!==void 0&&this.internal_send_command(new bt("select",[this.selected_db])),this.monitoring&&this.internal_send_command(new bt("monitor",[]));var e=Object.keys(this.subscription_set).length;if(!this.options.disable_resubscribing&&e){var t=function(){e--,e===0&&r.emit("ready")};_("Sending pub/sub on_ready commands");for(var i in this.subscription_set){var s=i.slice(0,i.indexOf("_")),a=this.subscription_set[i];this[s]([a],t)}this.send_offline_queue();return}this.send_offline_queue(),this.emit("ready")};f.prototype.on_info_cmd=function(r,e){if(r){if(r.message==="ERR unknown command 'info'"){this.on_ready();return}r.message="Ready check failed: "+r.message,this.emit("error",r);return}if(!e){_("The info command returned without any data."),this.on_ready();return}if(!this.server_info.loading||this.server_info.loading==="0")if(this.server_info.master_link_status&&this.server_info.master_link_status!=="up")this.server_info.loading_eta_seconds=.05;else{_("Redis server ready."),this.on_ready();return}var t=+this.server_info.loading_eta_seconds*1e3;t>1e3&&(t=1e3),_("Redis server still loading, trying again in "+t),setTimeout(function(i){i.ready_check()},t,this)};f.prototype.ready_check=function(){var r=this;_("Checking server ready state..."),this.ready=!0,this.info(function(e,t){r.on_info_cmd(e,t)}),this.ready=!1};f.prototype.send_offline_queue=function(){for(var r=this.offline_queue.shift();r;r=this.offline_queue.shift())_("Sending offline command: "+r.command),this.internal_send_command(r);this.drain()};var zr=function(r,e){_("Retrying connection...");var t={delay:r.retry_delay,attempt:r.attempts,error:e};r.options.camel_case?(t.totalRetryTime=r.retry_totaltime,t.timesConnected=r.times_connected):(t.total_retry_time=r.retry_totaltime,t.times_connected=r.times_connected),r.emit("reconnecting",t),r.retry_totaltime+=r.retry_delay,r.attempts+=1,r.retry_delay=Math.round(r.retry_delay*r.retry_backoff),r.create_stream(),r.retry_timer=null};f.prototype.connection_gone=function(r,e){if(!this.retry_timer){if(e=e||null,_("Redis connection is gone from "+r+" event."),this.connected=!1,this.ready=!1,this.cork=ee,this.uncork=ee,this.pipeline=!1,this.pub_sub_mode=0,this.emitted_end||(this.emit("end"),this.emitted_end=!0),this.closing){_("Connection ended by quit / end command, not retrying."),this.flush_and_error({message:"Stream connection ended and command aborted.",code:"NR_CLOSED"},{error:e});return}if(typeof this.options.retry_strategy=="function"){var t={attempt:this.attempts,error:e};if(this.options.camel_case?(t.totalRetryTime=this.retry_totaltime,t.timesConnected=this.times_connected):(t.total_retry_time=this.retry_totaltime,t.times_connected=this.times_connected),this.retry_delay=this.options.retry_strategy(t),typeof this.retry_delay!="number"){this.retry_delay instanceof Error&&(e=this.retry_delay);var i="Redis connection in broken state: retry aborted.";this.flush_and_error({message:i,code:"CONNECTION_BROKEN"},{error:e});var s=new Error(i);s.code="CONNECTION_BROKEN",e&&(s.origin=e),this.end(!1),this.emit("error",s);return}}if(this.retry_totaltime>=this.connect_timeout){var a="Redis connection in broken state: connection timeout exceeded.";this.flush_and_error({message:a,code:"CONNECTION_BROKEN"},{error:e});var n=new Error(a);n.code="CONNECTION_BROKEN",e&&(n.origin=e),this.end(!1),this.emit("error",n);return}this.options.retry_unfulfilled_commands?(this.offline_queue.unshift.apply(this.offline_queue,this.command_queue.toArray()),this.command_queue.clear()):this.command_queue.length!==0&&this.flush_and_error({message:"Redis connection lost and command aborted.",code:"UNCERTAIN_STATE"},{error:e,queues:["command_queue"]}),this.retry_totaltime+this.retry_delay>this.connect_timeout&&(this.retry_delay=this.connect_timeout-this.retry_totaltime),_("Retry connection in "+this.retry_delay+" ms"),this.retry_timer=setTimeout(zr,this.retry_delay,this,e)}};f.prototype.return_error=function(r){var e=this.command_queue.shift();e.error&&(r.stack=e.error.stack.replace(/^Error.*?\n/,"ReplyError: "+r.message+`
`)),r.command=e.command.toUpperCase(),e.args&&e.args.length&&(r.args=e.args),this.pub_sub_mode>1&&this.pub_sub_mode--;var t=r.message.match(v.err_code);t&&(r.code=t[1]),v.callback_or_emit(this,e.callback,r)};f.prototype.drain=function(){this.should_buffer=!1};function qe(r,e){var t=r.command_queue.shift();typeof t.callback=="function"?(t.command!=="exec"&&(e=r.handle_reply(e,t.command,t.buffer_args)),t.callback(null,e)):_("No callback for reply")}function Dr(r,e,t){var i=r.command_queue.get(0),s=r.options.return_buffers||r.options.detect_buffers&&i.buffer_args,a=s||e[1]===null?e[1]:e[1].toString(),n=+e[2];if(_(t,a),a!==null&&(r.emit(t,a,n),t==="subscribe"||t==="psubscribe"?r.subscription_set[t+"_"+a]=a:(t=t==="unsubscribe"?"subscribe":"psubscribe",delete r.subscription_set[t+"_"+a])),i.args.length===1||r.sub_commands_left===1||i.args.length===0&&(n===0||a===null)){if(n===0){var o,l=1;for(r.pub_sub_mode=0;o=r.command_queue.get(l);){if(Pr[o.command]){r.pub_sub_mode=l;break}l++}}r.command_queue.shift(),typeof i.callback=="function"&&i.callback(null,a),r.sub_commands_left=0}else r.sub_commands_left!==0?r.sub_commands_left--:r.sub_commands_left=i.args.length?i.args.length-1:n}function Br(r,e){var t=e[0].toString();t==="message"?!r.options.return_buffers||r.message_buffers?(r.emit("message",e[1].toString(),e[2].toString()),r.emit("message_buffer",e[1],e[2]),r.emit("messageBuffer",e[1],e[2])):r.emit("message",e[1],e[2]):t==="pmessage"?!r.options.return_buffers||r.message_buffers?(r.emit("pmessage",e[1].toString(),e[2].toString(),e[3].toString()),r.emit("pmessage_buffer",e[1],e[2],e[3]),r.emit("pmessageBuffer",e[1],e[2],e[3])):r.emit("pmessage",e[1],e[2],e[3]):Dr(r,e,t)}f.prototype.return_reply=function(r){if(this.monitoring){var e;if(this.buffers&&Buffer.isBuffer(r)?e=r.toString():e=r,typeof e=="string"&&v.monitor_regex.test(e)){var t=e.slice(0,e.indexOf(" ")),i=e.slice(e.indexOf('"')+1,-1).split('" "').map(function(s){return s.replace(/\\"/g,'"')});this.emit("monitor",t,i,e);return}}this.pub_sub_mode===0?qe(this,r):this.pub_sub_mode!==1?(this.pub_sub_mode--,qe(this,r)):!(r instanceof Array)||r.length<=2?qe(this,r):Br(this,r)};function Mr(r,e){var t=e.command,i,s;r.closing||!r.enable_offline_queue?(t=t.toUpperCase(),r.closing?s="The connection is already closed.":r.stream.writable?s="The connection is not yet established and the offline queue is deactivated.":s="Stream not writeable.",i=new U.AbortError({message:t+" can't be processed. "+s,code:"NR_CLOSED",command:t}),e.args.length&&(i.args=e.args),v.reply_in_order(r,e.callback,i)):(_("Queueing "+t+" for next server connection."),r.offline_queue.push(e)),r.should_buffer=!0}f.prototype.internal_send_command=function(r){var e,t,i=0,s="",a=r.args,n=r.command,o=a.length,l=!1,u=new Array(o);if(process.domain&&r.callback&&(r.callback=process.domain.bind(r.callback)),this.ready===!1||this.stream.writable===!1)return Mr(this,r),!1;for(i=0;i<o;i+=1)if(typeof a[i]=="string")a[i].length>3e4?(l=!0,u[i]=Buffer.from(a[i],"utf8")):u[i]=a[i];else if(typeof a[i]=="object")if(a[i]instanceof Date)u[i]=a[i].toString();else if(Buffer.isBuffer(a[i]))u[i]=a[i],r.buffer_args=!0,l=!0;else{var d=new Error("node_redis: The "+n.toUpperCase()+` command contains a invalid argument type.
Only strings, dates and buffers are accepted. Please update your code to use valid argument types.`);if(d.command=r.command.toUpperCase(),r.args&&r.args.length&&(d.args=r.args),r.callback)return r.callback(d),!1;throw d}else if(typeof a[i]>"u"){var E=new Error("node_redis: The "+n.toUpperCase()+` command contains a invalid argument type of "undefined".
Only strings, dates and buffers are accepted. Please update your code to use valid argument types.`);return E.command=r.command.toUpperCase(),r.args&&r.args.length&&(E.args=r.args),r.callback(E),!1}else u[i]=""+a[i];if(this.options.prefix)for(t=Ir.getKeyIndexes(n,u),i=t.pop();i!==void 0;i=t.pop())u[i]=this.options.prefix+u[i];if(this.options.rename_commands&&this.options.rename_commands[n]&&(n=this.options.rename_commands[n]),s="*"+(o+1)+`\r
$`+n.length+`\r
`+n+`\r
`,l===!1){for(i=0;i<o;i+=1)e=u[i],s+="$"+Buffer.byteLength(e)+`\r
`+e+`\r
`;_("Send "+this.address+" id "+this.connection_id+": "+s),this.write(s)}else for(_("Send command ("+s+") has Buffer arguments"),this.fire_strings=!1,this.write(s),i=0;i<o;i+=1)e=u[i],typeof e=="string"?this.write("$"+Buffer.byteLength(e)+`\r
`+e+`\r
`):(this.write("$"+e.length+`\r
`),this.write(e),this.write(`\r
`)),_("send_command: buffer send "+e.length+" bytes");return r.call_on_write&&r.call_on_write(),this.reply==="ON"?this.command_queue.push(r):(r.callback&&v.reply_in_order(this,r.callback,null,void 0,this.command_queue),this.reply==="SKIP"?this.reply="SKIP_ONE_MORE":this.reply==="SKIP_ONE_MORE"&&(this.reply="ON")),!this.should_buffer};f.prototype.write_strings=function(){for(var r="",e=this.pipeline_queue.shift();e;e=this.pipeline_queue.shift())r.length+e.length>4*1024*1024&&(this.should_buffer=!this.stream.write(r),r=""),r+=e;r!==""&&(this.should_buffer=!this.stream.write(r))};f.prototype.write_buffers=function(){for(var r=this.pipeline_queue.shift();r;r=this.pipeline_queue.shift())this.should_buffer=!this.stream.write(r)};f.prototype.write=function(r){if(this.pipeline===!1){this.should_buffer=!this.stream.write(r);return}this.pipeline_queue.push(r)};Object.defineProperty(b,"debugMode",{get:function(){return this.debug_mode},set:function(r){this.debug_mode=r}});Object.defineProperty(f.prototype,"command_queue_length",{get:function(){return this.command_queue.length}});Object.defineProperty(f.prototype,"offline_queue_length",{get:function(){return this.offline_queue.length}});Object.defineProperty(f.prototype,"retryDelay",{get:function(){return this.retry_delay}});Object.defineProperty(f.prototype,"retryBackoff",{get:function(){return this.retry_backoff}});Object.defineProperty(f.prototype,"commandQueueLength",{get:function(){return this.command_queue.length}});Object.defineProperty(f.prototype,"offlineQueueLength",{get:function(){return this.offline_queue.length}});Object.defineProperty(f.prototype,"shouldBuffer",{get:function(){return this.should_buffer}});Object.defineProperty(f.prototype,"connectionId",{get:function(){return this.connection_id}});Object.defineProperty(f.prototype,"serverInfo",{get:function(){return this.server_info}});b.createClient=function(){return new f(Kr.apply(null,arguments))};b.RedisClient=f;b.print=v.print;b.Multi=X();b.AbortError=U.AbortError;b.RedisError=Ae.RedisError;b.ParserError=Ae.ParserError;b.ReplyError=Ae.ReplyError;b.AggregateError=U.AggregateError;ht();pt();b.addCommand=b.add_command=kt()});var Ct=c(z=>{"use strict";var Jr=P();function Ur(r,e){let t;if(qt(r)){if(t=r,e)t=t.duplicate();else if(At(t))return Promise.resolve(t)}else typeof r=="object"&&(r=Object.assign({},r)),t=Jr.createClient(r);return new Promise((i,s)=>{t.on("ready",async()=>{i(t)}),t.on("reconnecting",a=>{console.log("Reconnecting:",a)}),t.on("error",a=>{console.log(a),Et(t),s(a)})})}function Et(r){r.disconnect?r.disconnect():r.end(!0)}function Lr(r){return r.name==="AbortError"||r.message==="Connection is closed."}function qt(r){if(!r||typeof r!="object")return!1;let e=r.constructor.name;return e==="Redis"||e==="RedisClient"}function At(r){return r.ready||r.status==="ready"}z.createClient=Ur;z.disconnect=Et;z.isAbortError=Lr;z.isClient=qt;z.isReady=At});var Ce=c((Ri,Tt)=>{"use strict";var jr=Object.prototype.hasOwnProperty;function Yr(r,e){return jr.call(r,e)}function Fr(r,e){return typeof r=="boolean"?r:e}function Gr(r,e){return r.then(t=>Promise.resolve(e()).then(()=>t),t=>{let i=()=>Promise.reject(t);return new Promise(s=>s(e())).then(i,i)})}Tt.exports={has:Yr,bool:Fr,finallyRejectsWithInitial:Gr,asCallback:function(r,e){return typeof e!="function"||r.then(t=>e(null,t)).catch(t=>e(t)),r},callAsync:function(r){return new Promise((e,t)=>{try{r((i,s)=>{if(i)return t(i);e(s)})}catch(i){t(i)}})},deferred:function(){let e,t;return{promise:new Promise((s,a)=>{e=s,t=a}),resolve:e,reject:t}},delay:function(e){return new Promise(t=>setTimeout(t,e))},withTimeout:function(r,e,t="Operation timed out"){let i,s=new Promise((a,n)=>{i=setTimeout(()=>n(new Error(t)),e)});return Promise.race([r.finally(()=>clearTimeout(i)),s])},wrapAsync:function(r,e={}){let t=typeof e.catchExceptions=="boolean"?e.catchExceptions:!0;return async function(...s){try{return r.length>s.length?await new Promise((a,n)=>{r.call(this,...s,(o,l)=>{if(o)return n(o);a(l)})}):await r.apply(this,s)}catch(a){if(t)throw a;return}}}}});var Rt=c((Oi,xt)=>{"use strict";var Wr=require("node:events").EventEmitter,w=Ce(),D=class extends Wr{constructor(e,t,i,s){super(),this.queue=e,this.id=t,this.progress=0,this.data=i||{},this.options=s||{},this.options.timestamp=this.options.timestamp||Date.now(),this.options.stacktraces=this.options.stacktraces||[],this.status="created"}static fromId(e,t,i){let s=e._commandable().then(a=>w.callAsync(n=>a.hget(e.toKey("jobs"),t,n))).then(a=>a?D.fromData(e,t,a):null);return i&&w.asCallback(s,i),s}static fromData(e,t,i){i=JSON.parse(i);let s=new D(e,t,i.data,i.options);return s.status=i.status,s.progress=i.progress,s}toData(){return JSON.stringify({data:this.data,options:this.options,status:this.status,progress:this.progress})}_save(e){let t=this.queue.toKey.bind(this.queue),i;return this.options.delay?(i=e(["addDelayedJob",4,t("id"),t("jobs"),t("delayed"),t("earlierDelayed"),this.id||"",this.toData(),this.options.delay]),this.queue.settings.activateDelayedJobs&&(i=i.then(s=>(s&&this.queue._delayedTimer.schedule(this.options.delay),s)))):i=e(["addJob",3,t("id"),t("jobs"),t("waiting"),this.id||"",this.toData()]),i.then(s=>(this.id=s,s&&this.queue.settings.storeJobs&&this.queue.jobs.set(s,this),this))}save(e){let t=this._save(i=>this.queue._evalScript.apply(this.queue,i));return e&&w.asCallback(t,e),t}setId(e){return this.id=e,this}retries(e){if(e<0)throw new Error("Retries cannot be negative");return this.options.retries=e,this}delayUntil(e){if(e&&typeof e.getTime=="function"?e=e.getTime():e=parseInt(e,10),isNaN(e)||e<0)throw new Error("invalid delay timestamp");return e>Date.now()&&(this.options.delay=e),this}timeout(e){if(e<0)throw new Error("Timeout cannot be negative");return this.options.timeout=e,this}backoff(e,t){if(!this.queue.backoffStrategies.has(e))throw new Error("unknown strategy");let i=!Number.isSafeInteger(t)||t<=0;if(e!=="immediate"&&i)throw new Error("delay must be a positive integer");return this.options.backoff={strategy:e,delay:t},this}reportProgress(e,t){let i;return e!=null?(this.progress=e,i=this.queue._commandable().then(s=>w.callAsync(a=>s.publish(this.queue.toKey("events"),JSON.stringify({id:this.id,event:"progress",data:e}),a)))):i=Promise.reject(new Error("Progress cannot be empty")),t&&w.asCallback(i,t),i}remove(e){let t=this.queue.removeJob(this.id).then(()=>this);return e&&w.asCallback(t,e),t}retry(e){let t=this.queue._commandable().then(i=>w.callAsync(s=>i.multi().srem(this.queue.toKey("failed"),this.id).lpush(this.queue.toKey("waiting"),this.id).exec(s)));return e&&w.asCallback(t,e),t}isInSet(e,t){let i=this.queue._commandable().then(s=>w.callAsync(a=>s.sismember(this.queue.toKey(e),this.id,a))).then(s=>s===1);return t&&w.asCallback(i,t),i}computeDelay(){let e=this.options.backoff?this.options.backoff.strategy:"immediate",t=this.options.retries>0?this.queue.backoffStrategies.get(e):null;return t?t(this):-1}};xt.exports=D});var It=c((Ii,Ot)=>{"use strict";Ot.exports={stallInterval:5e3,nearTermWindow:20*60*1e3,delayedDebounce:1e3,prefix:"bq",isWorker:!0,getEvents:!0,ensureScripts:!0,activateDelayedJobs:!1,sendEvents:!0,storeJobs:!0,removeOnSuccess:!1,removeOnFailure:!1,redisScanCount:100,initialRedisFailureRetryDelay:1e3,"#close":{timeout:5e3},"#process":{concurrency:1}}});var Kt=c((Ki,$r)=>{$r.exports=`--[[
key 1 -> bq:name:id (job ID counter)
key 2 -> bq:name:jobs
key 3 -> bq:name:delayed
key 4 -> bq:name:earlierDelayed
arg 1 -> job id
arg 2 -> job data
arg 3 -> job delay timestamp
]]

local jobId = ARGV[1]
if jobId == "" then
  jobId = "" .. redis.call("incr", KEYS[1])
end
if redis.call("hexists", KEYS[2], jobId) == 1 then return nil end
redis.call("hset", KEYS[2], jobId, ARGV[2])
redis.call("zadd", KEYS[3], tonumber(ARGV[3]), jobId)

-- if this job is the new head, alert the workers that they need to update their timers
-- if we try to do something tricky like checking the delta between this job and the next job, we
-- can enter a pathological case where jobs incrementally creep sooner, and each one never updates
-- the timers
local head = redis.call("zrange", KEYS[3], 0, 0)
if head[1] == jobId then
  redis.call("publish", KEYS[4], ARGV[3])
end

return jobId
`});var Pt=c((Pi,Vr)=>{Vr.exports=`--[[
key 1 -> bq:name:id (job ID counter)
key 2 -> bq:name:jobs
key 3 -> bq:name:waiting
arg 1 -> job id
arg 2 -> job data
]]

local jobId = ARGV[1]
if jobId == "" then
  jobId = "" .. redis.call("incr", KEYS[1])
end
if redis.call("hexists", KEYS[2], jobId) == 1 then return nil end
redis.call("hset", KEYS[2], jobId, ARGV[2])
redis.call("lpush", KEYS[3], jobId)

return jobId
`});var Nt=c((Ni,Hr)=>{Hr.exports=`--[[
key 1 -> bq:name:stallBlock
key 2 -> bq:name:stalling
key 3 -> bq:name:waiting
key 4 -> bq:name:active
arg 1 -> ms stallInterval

returns {resetJobId1, resetJobId2, ...}

workers are responsible for removing their jobId from the stalling set every stallInterval ms
if a jobId is not removed from the stalling set within a stallInterval window,
we assume the job has stalled and should be reset (moved from active back to waiting)
--]]

-- It isn't clear what this value should be, it depends on memory available for the stack.
-- This seems a reasonable limit.
local maxUnpack = 1024

-- try to update the stallBlock key
if not redis.call("set", KEYS[1], "1", "PX", tonumber(ARGV[1]), "NX") then
  -- hasn't been long enough (stallInterval) since last check
  return {}
end

-- reset any stalling jobs by moving from active to waiting
local stalling, stalled = redis.call("smembers", KEYS[2]), {}
if next(stalling) ~= nil then
  -- not worth optimizing - this should be a rare occurrence, better to keep it straightforward
  for i, jobId in ipairs(stalling) do
    local removed = redis.call("lrem", KEYS[4], 0, jobId)
    -- safety belts: we only restart stalled jobs if we can find them in the active list
    -- the only place we add jobs to the stalling set is in this script, and the two places we
    -- remove jobs from the active list are in this script, and in the MULTI after the job finishes
    if removed > 0 then
      stalled[#stalled + 1] = jobId
    end
  end
  
  -- lpush instead of rpush so that jobs which cause uncaught exceptions don't
  -- hog the job consumers and starve the whole system. not a great situation
  -- to be in, but this is fairer.
  local pushed = 0
  local nStalled = #stalled
  -- don't lpush zero jobs (the redis command will fail)
  while pushed < nStalled do
    redis.call("lpush", KEYS[3], unpack(stalled, pushed + 1, math.min(pushed + maxUnpack, nStalled)))
    pushed = pushed + maxUnpack
  end
  redis.call("del", KEYS[2])
end

-- copy currently active jobs into stalling set
local actives, added = redis.call("lrange", KEYS[4], 0, -1), 0
local nActives = #actives
while added < nActives do
  redis.call("sadd", KEYS[2], unpack(actives, added + 1, math.min(added + maxUnpack, nActives)))
  added = added + maxUnpack
end

return stalled
`});var zt=c((zi,Qr)=>{Qr.exports=`--[[
key 1 -> bq:name:delayed
key 2 -> bq:name:waiting
arg 1 -> ms timestamp ("now")
arg 2 -> debounce window (in milliseconds)

returns number of jobs raised and the timestamp of the next job (within the near-term window)
--]]

local now = tonumber(ARGV[1])

-- raise any delayed jobs that are now valid by moving from delayed to waiting
local offset = 0
-- There is a default 1024 element restriction
local count = 1000
while true do
  local raising = redis.call("zrangebyscore", KEYS[1], 0, ARGV[1], 'LIMIT', offset, count)
  local numRaising = #raising
  offset = offset + numRaising

  if numRaising > 0 then
    redis.call("lpush", KEYS[2], unpack(raising))
  else
    break
  end
end
redis.call("zremrangebyscore", KEYS[1], 0, ARGV[1])

local head = redis.call("zrange", KEYS[1], 0, 0, "WITHSCORES")
local nearTerm = -1
if next(head) ~= nil then
  local proximal = redis.call("zrevrangebyscore", KEYS[1], head[2] + tonumber(ARGV[2]), 0, "WITHSCORES", "LIMIT", 0, 1)
  nearTerm = proximal[2]
end

return {offset, nearTerm}`});var Dt=c((Di,Xr)=>{Xr.exports=`--[[
key 1 -> bq:test:succeeded
key 2 -> bq:test:failed
key 3 -> bq:test:waiting
key 4 -> bq:test:active
key 5 -> bq:test:stalling
key 6 -> bq:test:jobs
key 7 -> bq:test:delayed
arg 1 -> jobId
]]

local jobId = ARGV[1]

if (redis.call("sismember", KEYS[1], jobId) + redis.call("sismember", KEYS[2], jobId)) == 0 then
  redis.call("lrem", KEYS[3], 0, jobId)
  redis.call("lrem", KEYS[4], 0, jobId)
end

redis.call("srem", KEYS[1], jobId)
redis.call("srem", KEYS[2], jobId)
redis.call("srem", KEYS[5], jobId)
redis.call("hdel", KEYS[6], jobId)
redis.call("zrem", KEYS[7], jobId)
`});var Jt=c((Bi,Mt)=>{"use strict";var Zr=require("node:crypto"),Bt={addDelayedJob:Kt(),addJob:Pt(),checkStalledJobs:Nt(),raiseDelayedJobs:zt(),removeJob:Dt()},Te={},te={};function ei(r,e){Te[r]=e;let t=Zr.createHash("sha1");t.update(e),te[r]=t.digest("hex")}function ti(){for(var r in Bt)ei(r,Bt[r])}async function ri(r,e){var t=await new Promise((i,s)=>{r.script("exists",te[e],i)});t===null&&await new Promise((i,s)=>{r.script("load",Te[e],i)})}async function ii(r){return ti(),Promise.all(Object.keys(te).map(e=>ri(r,e)))}Mt.exports={scripts:Te,shas:te,buildCache:ii}});var Lt=c((Mi,Ut)=>{"use strict";var re=new Map;re.set("immediate",()=>0);re.set("fixed",r=>r.options.backoff.delay);re.set("exponential",r=>{let e=r.options.backoff,t=e.delay;return e.delay*=2,t});Ut.exports=re});var Yt=c((Ji,jt)=>{"use strict";var si=require("node:events").EventEmitter,xe=class extends si{constructor(e){if(super(),!Number.isSafeInteger(e)||e<=0)throw new Error("maximum delay must be a positive integer");this._maxDelay=e,this._nextTime=null,this._timer=null,this._stopped=!1,this._boundTrigger=this._trigger.bind(this)}schedule(e){if(this._stopped)return;let t=Date.now();if(e<0||e==null||isNaN(e))e=t+this._maxDelay;else{if(e<=t)return this._schedule(t+this._maxDelay),this.emit("trigger");e=Math.min(e,t+this._maxDelay)}(!this._timer||e<this._nextTime)&&this._schedule(e)}stop(){this._stop(),this._stopped=!0}_stop(){this._timer&&(clearTimeout(this._timer),this._nextTime=null,this._timer=null)}_schedule(e){let t=e-Date.now();this._stop(),this._nextTime=e,this._timer=setTimeout(this._boundTrigger,t)}_trigger(){let e=Date.now(),t=this._nextTime-e;if(t>0){this._timer=setTimeout(this._boundTrigger,t);return}this._schedule(e+this._maxDelay),this.emit("trigger")}};jt.exports=xe});var Wt=c((Ui,Gt)=>{"use strict";var L=Ct(),ai=require("node:events").EventEmitter,ie=Rt(),B=It(),Ft=Jt(),h=Ce(),ni=Lt(),oi=Yt(),Re=class extends ai{constructor(e,t={}){super(),this.name=e,this.paused=!1,this.jobs=new Map,this.activeJobs=new Set,this.checkTimer=null,this.backoffStrategies=new Map(ni),this._closed=null,this._isClosed=!1,this._emitError=i=>void this.emit("error",i),this._emitErrorAfterTick=i=>void process.nextTick(()=>this.emit("error",i)),this.client=null,this.bclient=null,this.eclient=null,this.settings={redis:t.redis||{},quitCommandClient:t.quitCommandClient,keyPrefix:(t.prefix||B.prefix)+":"+this.name+":",autoConnect:h.bool(t.autoConnect,!0)},this._isReady=!1,this._ready=!1;for(let i in B){let s=B[i],a=t[i],n=typeof s;n==="boolean"?this.settings[i]=typeof a=="boolean"?a:s:n==="number"&&(this.settings[i]=Number.isSafeInteger(a)?a:s)}this.settings.redis.socket&&(this.settings.redis=Object.assign({},this.settings.redis,{path:this.settings.redis.socket})),typeof this.settings.quitCommandClient!="boolean"&&(this.settings.quitCommandClient=!L.isClient(this.settings.redis)),this._delayedTimer=this.settings.activateDelayedJobs?new oi(this.settings.nearTermWindow):null,this._delayedTimer&&this._delayedTimer.on("trigger",this._activateDelayed.bind(this)),this.settings.autoConnect&&this.connect()}makeClient(e,t){return L.createClient(this.settings.redis,t).then(i=>(i.on("error",this._emitError),this[e]=i))}connect(){return new Promise((e,t)=>{try{if(this._isReady)return e(this._isReady);let s=(()=>this.settings.getEvents||this.settings.activateDelayedJobs?this.makeClient("eclient",!0).then(()=>{this.eclient.on("message",this._onMessage.bind(this));let a=[];return this.settings.getEvents&&a.push(this.toKey("events")),this.settings.activateDelayedJobs&&a.push(this.toKey("earlierDelayed")),Promise.all(a.map(n=>h.callAsync(o=>this.eclient.subscribe(n,o))))}):null)();this._ready=Promise.all([this.makeClient("client",!1),this.settings.isWorker?this.makeClient("bclient",!0):null,s]).then(()=>{if(this.settings.ensureScripts)return Ft.buildCache(this.client)}).then(()=>(this._isReady=!0,setImmediate(()=>this.emit("ready")),e(this._isReady),this))}catch(i){t(i)}})}_onMessage(e,t){if(e===this.toKey("earlierDelayed")){this._delayedTimer.schedule(parseInt(t,10));return}t=JSON.parse(t),(t.event==="failed"||t.event==="retrying")&&(t.data=new Error(t.data)),this.emit("job "+t.event,t.id,t.data);let i=this.jobs.get(t.id);i&&(t.event==="progress"?i.progress=t.data:t.event==="retrying"&&(i.options.retries-=1),i.emit(t.event,t.data),(t.event==="succeeded"||t.event==="failed")&&this.jobs.delete(t.id))}isRunning(){return!this.paused}ready(e){return e&&h.asCallback(this._ready.then(()=>{}),e),this._ready}_commandable(e){return(e?this.paused:this._isClosed)?Promise.reject(new Error("closed")):this._isReady?Promise.resolve(e?this.bclient:this.client):this._ready.then(()=>this._commandable(e))}close(e,t){if(typeof e=="function"?(t=e,e=B["#close"].timeout):(!Number.isSafeInteger(e)||e<=0)&&(e=B["#close"].timeout),this.paused)return t&&h.asCallback(this._closed,t),this._closed;this.paused=!0,this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null),this._delayedTimer&&this._delayedTimer.stop();let i=()=>h.finallyRejectsWithInitial(this._ready,()=>(this.settings.isWorker&&L.disconnect(this.bclient),Promise.all(Array.from(this.activeJobs,n=>n.catch(()=>{}))).then(()=>{}))),s=()=>{this._isClosed=!0;let n=[];return this.client&&(this.settings.quitCommandClient?n.push(this.client):this.client.removeListener("error",this._emitError)),this.eclient&&n.push(this.eclient),Promise.all(n.map(o=>h.callAsync(l=>o.quit(l))))},a=h.finallyRejectsWithInitial(h.withTimeout(i(),e),()=>s());return this._closed=a,t&&h.asCallback(a,t),a}destroy(e){let t=this._commandable().then(i=>{let s=h.deferred(),a=["id","jobs","stallBlock","stalling","waiting","active","succeeded","failed","delayed"].map(n=>this.toKey(n));return a.push(s.defer()),i.del.apply(i,a),s});return e&&h.asCallback(t,e),t}checkHealth(e){let t=this._commandable().then(i=>h.callAsync(s=>i.multi().llen(this.toKey("waiting")).llen(this.toKey("active")).scard(this.toKey("succeeded")).scard(this.toKey("failed")).zcard(this.toKey("delayed")).get(this.toKey("id")).exec(s))).then(i=>({waiting:i[0],active:i[1],succeeded:i[2],failed:i[3],delayed:i[4],newestJob:i[5]?parseInt(i[5],10):0}));return e&&h.asCallback(t,e),t}_scanForJobs(e,t,i,s,a){let n=Math.min(i,this.settings.redisScanCount);this.client.sscan(e,t,"COUNT",n,(o,l)=>{if(o)return a(o);let u=l[0],d=l[1];for(let E of d){if(s.size===i)break;s.add(E)}if(u==="0"||s.size>=i)return a(null,s);this._scanForJobs(e,u,i,s,a)})}_addJobsByIds(e,t){return this._commandable().then(i=>{let s=h.deferred(),a=[this.toKey("jobs")].concat(t,s.defer());return i.hmget.apply(i,a),s}).then(i=>{let s=t.length;for(let a=0;a<s;++a){let n=i[a];n&&e.push(ie.fromData(this,t[a],n))}return e})}getJobs(e,t,i){typeof t=="function"&&(i=t,t=null),t=Object.assign({size:100,start:0,end:100},t);let s=this._commandable().then(a=>{let n=h.deferred(),o=n.defer(),l=this.toKey(e);switch(e){case"failed":case"succeeded":this._scanForJobs(l,"0",t.size,new Set,o);break;case"waiting":case"active":a.lrange(l,t.start,t.end,o);break;case"delayed":a.zrange(l,t.start,t.end,o);break;default:throw new Error("Improper queue type")}return n}).then(a=>{let n=[],o=[];for(let l of a){let u=this.jobs.get(l);u?n.push(u):o.push(l)}return o.length?this._addJobsByIds(n,o):n});return i&&h.asCallback(s,i),s}createJob(e){return new ie(this,null,e)}getJob(e,t){let i=this._commandable().then(()=>this.jobs.has(e)?this.jobs.get(e):ie.fromId(this,e)).then(s=>(s&&this.settings.storeJobs&&this.jobs.set(e,s),s));return t&&h.asCallback(i,t),i}removeJob(e,t){let i=this._evalScript("removeJob",7,this.toKey("succeeded"),this.toKey("failed"),this.toKey("waiting"),this.toKey("active"),this.toKey("stalling"),this.toKey("jobs"),this.toKey("delayed"),e).then(()=>(this.settings.storeJobs&&this.jobs.delete(e),this));return t&&h.asCallback(i,t),i}_waitForJob(){return h.callAsync(e=>this.bclient.brpoplpush(this.toKey("waiting"),this.toKey("active"),0,e)).then(e=>ie.fromId(this,e),e=>L.isAbortError(e)&&this.paused?null:(this.emit("error",e),this._redisFailureRetryDelay=this._redisFailureRetryDelay?this._redisFailureRetryDelay*2:this.settings.initialRedisFailureRetryDelay,h.delay(this._redisFailureRetryDelay).then(()=>this._waitForJob())))}_getNextJob(){return this._redisFailureRetryDelay=0,this._commandable(!0).then(()=>this._waitForJob())}_runJob(e){let t=null,i=!1,s=()=>{t=null,!this._isClosed&&this._preventStall(e.id).catch(this._emitErrorAfterTick).finally(()=>{if(i||this._isClosed)return;let l=this.settings.stallInterval/2;t=setTimeout(s,l)})};s();let a=(l,u)=>(i=!0,t&&(clearTimeout(t),t=null),this._finishJob(l,u,e)),n=this.handler(e);if(e.options.timeout){let l=`Job ${e.id} timed out (${e.options.timeout} ms)`;n=h.withTimeout(n,e.options.timeout,l)}let o=n.then(l=>a(null,l),a).finally(()=>{this.activeJobs.delete(o)});return this.activeJobs.add(o),o}_preventStall(e){return h.callAsync(t=>this.client.srem(this.toKey("stalling"),e,t))}_finishJob(e,t,i){if(this._isClosed){let l=e?"failed":"succeeded";throw new Error(`unable to update the status of ${l} job ${i.id}`)}let s=this.client.multi().lrem(this.toKey("active"),0,i.id).srem(this.toKey("stalling"),i.id),a=e?i.computeDelay():-1,n=e?a>=0?"retrying":"failed":"succeeded";if(i.status=n,e){let l=e.stack||e.message||e;i.options.stacktraces.unshift(l)}switch(n){case"failed":this.settings.removeOnFailure?s.hdel(this.toKey("jobs"),i.id):(s.hset(this.toKey("jobs"),i.id,i.toData()),s.sadd(this.toKey("failed"),i.id));break;case"retrying":if(--i.options.retries,s.hset(this.toKey("jobs"),i.id,i.toData()),a===0)s.lpush(this.toKey("waiting"),i.id);else{let l=Date.now()+a;s.zadd(this.toKey("delayed"),l,i.id).publish(this.toKey("earlierDelayed"),l)}break;case"succeeded":this.settings.removeOnSuccess?s.hdel(this.toKey("jobs"),i.id):(s.hset(this.toKey("jobs"),i.id,i.toData()),s.sadd(this.toKey("succeeded"),i.id));break}this.settings.sendEvents&&s.publish(this.toKey("events"),JSON.stringify({id:i.id,event:n,data:e?e.message:t}));let o=e||t;return h.callAsync(l=>s.exec(l)).then(()=>[n,o])}process(e,t){if(!this.settings.isWorker)throw new Error("Cannot call Queue#process on a non-worker");if(this.handler)throw new Error("Cannot call Queue#process twice");if(this.paused)throw new Error("closed");typeof e=="function"&&(t=e,e=B["#process"].concurrency);let i=!0;this.handler=h.wrapAsync(t,i),this.running=0,this.queued=1,this.concurrency=e;let s=()=>{if(this.paused){this.queued-=1;return}this._getNextJob().then(a=>{if(this.paused){this.queued-=1;return}if(this.running+=1,this.queued-=1,this.running+this.queued<this.concurrency&&(this.queued+=1,setImmediate(s)),!!a)return this._runJob(a).then(n=>{if(this.running-=1,this.queued+=1,n){let o=n[0],l=n[1];this.emit(o,a,l);let u=o==="retrying"?"failed":o==="failed"?"failed:fatal":null;u&&this.emit(u,a,l)}},this._emitErrorAfterTick)}).catch(this._emitErrorAfterTick).finally(()=>setImmediate(s))};return this._doStalledJobCheck().then(s).catch(this._emitErrorAfterTick),this._activateDelayed(),this}_doStalledJobCheck(){return this._evalScript("checkStalledJobs",4,this.toKey("stallBlock"),this.toKey("stalling"),this.toKey("waiting"),this.toKey("active"),this.settings.stallInterval).then(e=>{for(let t of e)this.emit("stalled",t);return e.length})}_safeCheckStalledJobs(e,t){let i=this._checkStalledJobs(e,t);t||i.catch(this._emitErrorAfterTick)}_scheduleStalledCheck(e,t){this.checkTimer||this.paused||(this.checkTimer=setTimeout(()=>{this.checkTimer=null,this._safeCheckStalledJobs(e,t)},e))}_checkStalledJobs(e,t){let i=this._doStalledJobCheck();return t&&h.asCallback(i,t),e&&!this.checkTimer?i.finally(()=>{try{this._scheduleStalledCheck(e,t)}catch(s){this._emitErrorAfterTick(s)}}):i}checkStalledJobs(e,t){return typeof e=="function"?(t=e,e=null):Number.isSafeInteger(e)||(e=null),this._checkStalledJobs(e,t)}saveAll(e){return this._commandable().then(t=>{let i=t.batch(),s=new Map;for(let a of e)try{a._save(n=>this._evalScriptOn(i,n)).catch(n=>void s.set(a,n))}catch(n){s.set(a,n)}return h.callAsync(a=>i.exec(a)).then(()=>s)})}_activateDelayed(){!this.settings.activateDelayedJobs||this._evalScript("raiseDelayedJobs",2,this.toKey("delayed"),this.toKey("waiting"),Date.now(),this.settings.delayedDebounce).then(e=>{let t=e[0],i=e[1];t&&this.emit("raised jobs",t),this._delayedTimer.schedule(parseInt(i,10))},e=>{if(L.isAbortError(e))return this.paused?void 0:this._activateDelayed();this._emitErrorAfterTick(e)})}toKey(e){return this.settings.keyPrefix+e}_evalScriptOn(e,t){return t[0]=Ft.shas[t[0]],h.callAsync(i=>{t.push(i),e.evalsha.apply(e,t)})}_evalScript(){let e=Array.from(arguments);return this._commandable().then(t=>this._evalScriptOn(t,e))}};Gt.exports=Re});module.exports=Wt();
